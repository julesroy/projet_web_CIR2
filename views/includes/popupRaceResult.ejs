<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.10.2/Sortable.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<div id="overlay" class="fixed inset-0 bg-black opacity-50 z-50 hidden"></div>

<div
    id="popup"
    class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-lg shadow-lg z-50 p-8 hidden w-4/5"
>
    <button
        id="closeButton"
        class="absolute top-0 right-0 mt-2 mr-2 focus:outline-none text-gray-600 hover:text-gray-800"
    >
        &times;
    </button>
    <h2 class="text-lg font-semibold mb-4">
        Enter the result of last race - <%= racePlace %>
    </h2>

    <div
        id="sortableList"
        class="grid grid-cols-4 items-center gap-4 overflow-y-auto max-h-96"
    >
        <article
            id="ver"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Max Verstappen - 1
                </p>
            </div>
            <span class="text-l standing-number"> 1 </span>
        </article>

        <article
            id="per"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Sergio Pérez - 11
                </p>
            </div>
            <span class="text-l standing-number"> 2 </span>
        </article>

        <article
            id="alo"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Fernando Alonso - 14
                </p>
            </div>
            <span class="text-l standing-number"> 3 </span>
        </article>

        <article
            id="str"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Lance Stroll - 18
                </p>
            </div>
            <span class="text-l standing-number"> 4 </span>
        </article>

        <article
            id="sai"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Carlos Sainz - 55
                </p>
            </div>
            <span class="text-l standing-number"> 5 </span>
        </article>

        <article
            id="lec"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Charles Leclerc - 16
                </p>
            </div>
            <span class="text-l standing-number"> 6 </span>
        </article>

        <article
            id="pia"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Oscar Piastri - 81
                </p>
            </div>
            <span class="text-l standing-number"> 7 </span>
        </article>

        <article
            id="nor"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">Lando Norris - 4</p>
            </div>
            <span class="text-l standing-number"> 8 </span>
        </article>

        <article
            id="rus"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    George Russell - 63
                </p>
            </div>
            <span class="text-l standing-number"> 9 </span>
        </article>

        <article
            id="ham"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Lewis Hamilton - 44
                </p>
            </div>
            <span class="text-l standing-number"> 10 </span>
        </article>

        <article
            id="hul"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Nico Hulkenberg - 27
                </p>
            </div>
            <span class="text-l standing-number"> 11 </span>
        </article>

        <article
            id="mag"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Kevin Magnussen - 20
                </p>
            </div>
            <span class="text-l standing-number"> 12 </span>
        </article>

        <article
            id="alb"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Alexander Albon - 23
                </p>
            </div>
            <span class="text-l standing-number"> 13 </span>
        </article>

        <article
            id="sar"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Logan Sargeant - 2
                </p>
            </div>
            <span class="text-l standing-number"> 14 </span>
        </article>

        <article
            id="ric"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Daniel Ricciardo - 3
                </p>
            </div>
            <span class="text-l standing-number"> 15 </span>
        </article>

        <article
            id="tsu"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Yuki Tsunoda - 22
                </p>
            </div>
            <span class="text-l standing-number"> 16 </span>
        </article>

        <article
            id="bot"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Valtteri Bottas - 77
                </p>
            </div>
            <span class="text-l standing-number"> 17 </span>
        </article>

        <article
            id="zho"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">Guanyu Zhou - 24</p>
            </div>
            <span class="text-l standing-number"> 18 </span>
        </article>

        <article
            id="gas"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Pierre Gasly - 10
                </p>
            </div>
            <span class="text-l standing-number"> 19 </span>
        </article>

        <article
            id="oco"
            class="w-3/4 mt-4 flex items-center gap-4 rounded-lg border border-gray-100 bg-white p-2 sm:justify-between"
        >
            <div>
                <p class="text-l font-medium text-gray-900">
                    Esteban Ocon - 31
                </p>
            </div>
            <span class="text-l standing-number"> 20 </span>
        </article>
    </div>

    <script>
        // Récupérer les éléments DOM
        const popup = document.getElementById("popup");
        const closeButton = document.getElementById("closeButton");
        const images = document.querySelectorAll("#popup img");
        const validateButton = document.getElementById("validateButton");
        const overlay = document.getElementById("overlay");
        const openButton = document.getElementById("openButton");

        openButton.addEventListener("click", function (event) {
            event.preventDefault(); // Empêche le comportement par défaut du lien
            overlay.classList.remove("hidden");
            popup.classList.remove("hidden");
        });

        closeButton.addEventListener("click", function () {
            overlay.classList.add("hidden");
            popup.classList.add("hidden");
        });

        var sortableList = document.getElementById("sortableList");

        new Sortable(sortableList, {
            animation: 150,
            ghostClass: "sortable-ghost",
            dataIdAttr: "id",
            onEnd: function (/**Event*/ evt) {
                var items = sortableList.children;
                for (var i = 0; i < items.length; i++) {
                    var item = items[i];
                    var numberSpan = item.querySelector(".standing-number");
                    numberSpan.textContent = i + 1;
                }
                var itemIds = this.toArray();
                $.post("/update-result", { order: itemIds });
            },
        });
    </script>

    <style>
        /* Ajouter une marge à gauche et à droite de la popup */
        #popup {
            max-height: 80vh;
        }

        /* Ajouter un style pour l'image sélectionnée */
        .selected-image {
            border: 2px solid blue;
        }
    </style>

    <br />
    <div class="validation"><a href="/validate-result">Validate</a></div>
</div>
